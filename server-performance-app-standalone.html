<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Performance Analysis Report</title>
    
    <!-- Include Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Include Recharts -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
    
    <!-- Include Remix Icons -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <style>
        /* Custom styles */
        body {
            background-color: #f9fafb;
        }
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 1.5rem;
        }
        .chart-container {
            background: white;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Injected report data -->
    <script>
        /* REPORT_DATA */
    </script>

    <!-- Application code -->
    <script>
        const { useState } = React;
        const { 
            LineChart, Line, XAxis, YAxis, CartesianGrid, 
            Tooltip, Legend, ResponsiveContainer, ReferenceLine 
        } = Recharts;

        // Format timestamp for display
        function formatTime(timestamp) {
            const date = new Date(timestamp * 1000);
            return `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}:${date.getSeconds().toString().padStart(2, '0')}`;
        }

        function App() {
            const reportData = window.REPORT_DATA;
            const [showDetailedTable, setShowDetailedTable] = useState(false);

            return (
                <div className="container mx-auto px-4 py-6 max-w-7xl">
                    <header className="flex items-center justify-between mb-6">
                        <div>
                            <h1 className="text-3xl font-bold text-primary">Server Performance Analysis Report</h1>
                            <p className="text-gray-600">Generated on {new Date(reportData.timestamp).toLocaleString()}</p>
                            <p className="text-gray-500 text-sm">Exported on {new Date(reportData.exportedAt).toLocaleString()}</p>
                        </div>
                        <div className="text-sm text-gray-500">
                            {reportData.data.length} data points
                            {reportData.data.length > 1000 && " (sampled)"}
                        </div>
                    </header>

                    {/* Executive Summary */}
                    <div className="mb-8">
                        <h2 className="text-xl font-semibold mb-4">Executive Summary</h2>
                        <div className="bg-white rounded-lg shadow p-5">
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                <div className="bg-blue-50 rounded-lg p-4">
                                    <h3 className="text-lg font-medium text-blue-700">CPU Usage</h3>
                                    <p className="text-2xl font-bold">{reportData.metrics.cpu.max}%</p>
                                    <p className="text-sm text-blue-600">Peak CPU Utilization</p>
                                </div>
                                <div className="bg-purple-50 rounded-lg p-4">
                                    <h3 className="text-lg font-medium text-purple-700">FLIT</h3>
                                    <p className="text-2xl font-bold">{reportData.metrics.flit.max}%</p>
                                    <p className="text-sm text-purple-600">Peak FLIT Percentage</p>
                                </div>
                                <div className="bg-green-50 rounded-lg p-4">
                                    <h3 className="text-lg font-medium text-green-700">Manager Cycle</h3>
                                    <p className="text-2xl font-bold">{reportData.metrics.cycle.avg.toFixed(2)}ms</p>
                                    <p className="text-sm text-green-600">Average Cycle Time</p>
                                </div>
                                <div className="bg-red-50 rounded-lg p-4">
                                    <h3 className="text-lg font-medium text-red-700">Overload Events</h3>
                                    <p className="text-2xl font-bold">{reportData.overloadEvents.length}</p>
                                    <p className="text-sm text-red-600">Total Events</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* System Resources Chart */}
                    <div className="chart-container">
                        <h3 className="text-lg font-medium mb-4">System Resources Timeline</h3>
                        <div style={{ width: '100%', height: 400 }}>
                            <ResponsiveContainer>
                                <LineChart data={reportData.data}>
                                    <CartesianGrid strokeDasharray="3 3" />
                                    <XAxis 
                                        dataKey="timestamp" 
                                        tickFormatter={formatTime}
                                    />
                                    <YAxis />
                                    <Tooltip 
                                        formatter={(value, name) => [
                                            `${value}${name.includes('%') ? '%' : 'ms'}`,
                                            name
                                        ]}
                                        labelFormatter={formatTime}
                                    />
                                    <Legend />
                                    <Line 
                                        type="monotone" 
                                        dataKey="cpu_all" 
                                        name="CPU %" 
                                        stroke="#ff0000" 
                                        dot={false}
                                    />
                                    <Line 
                                        type="monotone" 
                                        dataKey="flit" 
                                        name="FLIT %" 
                                        stroke="#0000ff" 
                                        dot={false}
                                    />
                                    <Line 
                                        type="monotone" 
                                        dataKey="avg_manager_cycle" 
                                        name="Manager Cycle (ms)" 
                                        stroke="#00aa00" 
                                        dot={false}
                                    />
                                </LineChart>
                            </ResponsiveContainer>
                        </div>
                    </div>

                    {/* Detailed Events Table */}
                    <div className="mb-8">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="text-lg font-medium">Overload Events</h3>
                            <button
                                onClick={() => setShowDetailedTable(!showDetailedTable)}
                                className="px-4 py-2 text-sm border rounded hover:bg-gray-50"
                            >
                                {showDetailedTable ? 'Hide Details' : 'Show Details'}
                            </button>
                        </div>
                        {showDetailedTable && (
                            <div className="bg-white rounded-lg shadow overflow-x-auto">
                                <table className="min-w-full divide-y divide-gray-200">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">CPU</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">FLIT</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cycle</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ARL ID</th>
                                        </tr>
                                    </thead>
                                    <tbody className="bg-white divide-y divide-gray-200">
                                        {(reportData.overloadEvents || []).slice(0, 100).map((event, index) => (
                                            <tr key={index}>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                    {formatTime(event.timestamp)}
                                                </td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                    {event.cpu_all}%
                                                </td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                    {event.flit}%
                                                </td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                    {event.avg_manager_cycle.toFixed(2)}ms
                                                </td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                    {event.arlid || 'N/A'}
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Render the application
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>